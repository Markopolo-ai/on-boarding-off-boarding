{"version":3,"sources":["../../src/react-popper.ts"],"names":["resolve","obj","elements","prev","next","map","element","isPopperEqual","popper","isArrowEqual","arrow","EMPTY_MODIFIERS","usePopper","referenceElement","popperElement","options","enabled","prevOptions","React","useRef","optionsWithDefaults","onFirstUpdate","placement","strategy","modifiers","useState","popperState","setPopperState","position","left","top","styles","setStyles","attrs","setAttrs","updateStateModifier","useMemo","name","phase","fn","state","Object","keys","attributes","requires","popperOptions","newOptions","current","popperInstanceRef","setOptions","createPopper","defaultCreatePopper","popperInstance","destroy","useEffect","id","requestAnimationFrame","forceUpdate","cancelAnimationFrame","update"],"mappings":"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","sourcesContent":["import { useSafeLayoutEffect } from \"@chakra-ui/hooks\"\nimport { fromEntries } from \"@chakra-ui/utils\"\nimport {\n  createPopper as defaultCreatePopper,\n  Instance,\n  Modifier,\n  Options as PopperOptions,\n  VirtualElement,\n  State as PopperState,\n} from \"@popperjs/core\"\nimport { dequal } from \"dequal\"\nimport * as React from \"react\"\n\ntype Options = Partial<PopperOptions> & {\n  enabled?: boolean\n  createPopper?: typeof defaultCreatePopper\n}\n\ntype State = {\n  styles: {\n    [key: string]: Partial<React.CSSProperties>\n  }\n  attributes: {\n    [key: string]: { [key: string]: string }\n  }\n}\n\nfunction resolve(obj: any, elements: string[]) {\n  return (prev: any) => {\n    const next = fromEntries(\n      elements.map((element) => [element, obj[element]]),\n    ) as any\n\n    const isPopperEqual = dequal(prev.popper, next.popper)\n    const isArrowEqual = dequal(prev.arrow, next.arrow)\n\n    if (isArrowEqual && isPopperEqual) return prev\n    return next\n  }\n}\n\nconst EMPTY_MODIFIERS: any[] = []\n\nexport function usePopper(\n  referenceElement: Element | VirtualElement,\n  popperElement: HTMLElement,\n  options: Options = {},\n) {\n  const { enabled = true } = options\n\n  const prevOptions = React.useRef<any>(null)\n\n  const optionsWithDefaults = {\n    onFirstUpdate: options.onFirstUpdate,\n    placement: options.placement || \"bottom\",\n    strategy: options.strategy || \"absolute\",\n    modifiers: options.modifiers || EMPTY_MODIFIERS,\n  }\n\n  const [popperState, setPopperState] = React.useState<PopperState | null>(null)\n  const [styles, setStyles] = React.useState<State[\"styles\"]>({\n    popper: {\n      position: optionsWithDefaults.strategy,\n      left: \"0\",\n      top: \"0\",\n    },\n  })\n\n  const [attrs, setAttrs] = React.useState<State[\"attributes\"]>({})\n\n  const updateStateModifier: Modifier<\"updateState\", any> = React.useMemo(\n    () => ({\n      name: \"updateState\",\n      enabled: true,\n      phase: \"write\",\n      fn: ({ state }) => {\n        const elements = Object.keys(state.elements)\n\n        setPopperState(state)\n\n        setStyles(resolve(state.styles, elements))\n        setAttrs(resolve(state.attributes, elements))\n      },\n      requires: [\"computeStyles\"],\n    }),\n    [],\n  )\n\n  const popperOptions = React.useMemo(() => {\n    const newOptions = {\n      onFirstUpdate: optionsWithDefaults.onFirstUpdate,\n      placement: optionsWithDefaults.placement,\n      strategy: optionsWithDefaults.strategy,\n      modifiers: [\n        ...optionsWithDefaults.modifiers,\n        updateStateModifier,\n        { name: \"applyStyles\", enabled: false },\n      ],\n    }\n\n    if (dequal(prevOptions.current, newOptions)) {\n      return prevOptions.current || newOptions\n    }\n\n    prevOptions.current = newOptions\n    return newOptions\n  }, [\n    optionsWithDefaults.onFirstUpdate,\n    optionsWithDefaults.placement,\n    optionsWithDefaults.strategy,\n    optionsWithDefaults.modifiers,\n    updateStateModifier,\n  ])\n\n  const popperInstanceRef = React.useRef<Instance | null>()\n\n  useSafeLayoutEffect(() => {\n    if (popperInstanceRef.current) {\n      popperInstanceRef.current.setOptions(popperOptions)\n    }\n  }, [popperOptions])\n\n  useSafeLayoutEffect(() => {\n    if (!enabled || referenceElement == null || popperElement == null) {\n      return\n    }\n\n    const createPopper = options.createPopper || defaultCreatePopper\n    const popperInstance = createPopper(\n      referenceElement,\n      popperElement,\n      popperOptions,\n    )\n\n    popperInstanceRef.current = popperInstance\n\n    return () => {\n      popperInstance.destroy()\n      popperInstanceRef.current = null\n    }\n  }, [enabled, referenceElement, popperElement, options.createPopper])\n\n  React.useEffect(() => {\n    const id = requestAnimationFrame(() => {\n      popperInstanceRef.current?.forceUpdate()\n    })\n    return () => {\n      cancelAnimationFrame(id)\n    }\n  }, [])\n\n  return {\n    state: popperState || null,\n    styles,\n    attributes: attrs,\n    update: popperInstanceRef.current ? popperInstanceRef.current.update : null,\n    forceUpdate: popperInstanceRef.current\n      ? popperInstanceRef.current.forceUpdate\n      : null,\n  }\n}\n"],"file":"react-popper.js"}